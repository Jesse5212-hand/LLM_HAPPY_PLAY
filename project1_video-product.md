# è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨é¡¹ç›®å­¦ä¹ ç¬”è®°  

## ä¸€ã€é¡¹ç›®æ ¸å¿ƒåŠŸèƒ½  
### 1. ç”¨æˆ·è¾“å…¥  
- **OpenAI API å¯†é’¥**ï¼šæ”¯æŒæ›¿æ¢ä¸ºæ–‡å¿ƒä¸€è¨€ã€é€šä¹‰åƒé—®ç­‰å…¶ä»–å¤§æ¨¡å‹å¯†é’¥ï¼ˆéœ€ä¿®æ”¹åç«¯æ¨¡å‹è°ƒç”¨é€»è¾‘ï¼‰ã€‚  
- **è§†é¢‘ä¸»é¢˜**ï¼šä»»æ„ä¸»é¢˜ï¼ˆå¦‚â€œSora æ¨¡å‹â€â€œç¾é£Ÿåˆ¶ä½œâ€ï¼‰ã€‚  
- **è§†é¢‘æ—¶é•¿**ï¼šåˆ†é’Ÿçº§ç²¾åº¦ï¼ˆæ”¯æŒå°æ•°ï¼Œå¦‚ `0.5` åˆ†é’Ÿï¼‰ã€‚  
- **è„šæœ¬åˆ›é€ åŠ›**ï¼šæ»‘å—è°ƒèŠ‚ï¼ˆ0~1ï¼‰ï¼Œå¯¹åº” OpenAI çš„ `temperature` å‚æ•°ï¼ˆå€¼è¶Šé«˜ï¼Œè¾“å‡ºè¶Šå¼€æ”¾æœ‰åˆ›æ„ï¼‰ã€‚  

### 2. æ ¸å¿ƒèƒ½åŠ›  
- **ç»´åŸºç™¾ç§‘ API è¡¥å……çŸ¥è¯†**ï¼šè§£å†³å¤§æ¨¡å‹è®­ç»ƒæ•°æ®æ»åé—®é¢˜ï¼ˆå¦‚ Sora æ¨¡å‹ 2024 å¹´å‘å¸ƒï¼Œæ—§æ¨¡å‹æ— ç›¸å…³ä¿¡æ¯ï¼‰ï¼Œç¡®ä¿å†…å®¹çœŸå®ã€‚  
- **LangChain ä¸²è”æµç¨‹**ï¼šæ•´åˆâ€œæ ‡é¢˜ç”Ÿæˆ â†’ ç»´åŸºçŸ¥è¯†è·å– â†’ è„šæœ¬ç”Ÿæˆâ€å…¨æµç¨‹ã€‚  
- **å‰ç«¯äº¤äº’ä¼˜åŒ–**ï¼šåŠ è½½æ€æç¤ºã€ç»“æœæŠ˜å å±•ç¤ºï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚  


## äºŒã€æŠ€æœ¯æ ˆä¸ç¯å¢ƒæ­å»º  
### 1. å…³é”®æŠ€æœ¯  
| æŠ€æœ¯/åº“          | ä½œç”¨                                  |  
|------------------|---------------------------------------|  
| **LangChain**    | ä¸²è”å¤§æ¨¡å‹ã€æç¤ºæ¨¡æ¿ã€ç»´åŸºç™¾ç§‘ APIï¼Œå®ç°è‡ªåŠ¨åŒ–æµç¨‹ |  
| **Streamlit**    | å¿«é€Ÿæ­å»º Web ç•Œé¢ï¼ˆçº¯ Python ç¼–å†™ï¼Œæ— éœ€å‰ç«¯çŸ¥è¯†ï¼‰ |  
| **Wikipedia API**| è¡¥å……å®æ—¶çŸ¥è¯†ï¼Œé¿å… AI è¾“å‡ºâ€œèƒ¡ç¼–ä¹±é€ â€          |  
| **è™šæ‹Ÿç¯å¢ƒ**     | éš”ç¦»é¡¹ç›®ä¾èµ–ï¼ˆå¯é€‰ï¼Œå°é¡¹ç›®å¯è·³è¿‡ï¼Œé¿å…ç‰ˆæœ¬å†²çªï¼‰  |  


### 2. ç¯å¢ƒæ­å»ºæ­¥éª¤  
#### ï¼ˆ1ï¼‰åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰  
```bash  
# Windows  
python -m venv venv  
venv\Scripts\activate  

# Linux/Mac  
python -m venv venv  
source venv/bin/activate  
```  

#### ï¼ˆ2ï¼‰å®‰è£…ä¾èµ–  
ä»è¯¾ç¨‹è·å– `requirements.txt`ï¼Œè¿è¡Œï¼š  
```bash  
pip install -r requirements.txt  
```  
**æ ¸å¿ƒä¾èµ–**ï¼š`langchain-openai`ã€`langchain-community`ã€`streamlit`ã€`wikipedia-api`  


## ä¸‰ã€åç«¯é€»è¾‘ï¼š`generate_script` å‡½æ•°è§£æ  
### 1. åŠŸèƒ½æ‹†è§£  
1. **ç”Ÿæˆè§†é¢‘æ ‡é¢˜**ï¼šé€šè¿‡æç¤ºæ¨¡æ¿è®© AI ç”Ÿæˆå¸ç›æ ‡é¢˜ã€‚  
2. **è·å–ç»´åŸºç™¾ç§‘çŸ¥è¯†**ï¼šè°ƒç”¨ç»´åŸºç™¾ç§‘ APIï¼Œè¡¥å……å®æ—¶ä¿¡æ¯ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰ã€‚  
3. **ç”Ÿæˆè§†é¢‘è„šæœ¬**ï¼šç»“åˆæ ‡é¢˜ã€æ—¶é•¿ã€ç»´åŸºçŸ¥è¯†ï¼Œè®© AI ç”Ÿæˆå®Œæ•´è„šæœ¬ã€‚  


### 2. ä»£ç æ ¸å¿ƒç‰‡æ®µ  
```python  
from langchain.prompts import ChatPromptTemplate  
from langchain_openai import ChatOpenAI  
from langchain_community.utilities import WikipediaAPIWrapper  

def generate_script(subject, duration, creativity, api_key):  
    # 1. å®šä¹‰æ ‡é¢˜ç”Ÿæˆæ¨¡æ¿  
    title_template = ChatPromptTemplate.from_messages([  
        ("human", "ä¸ºã€Œ{subject}ã€ç”Ÿæˆä¸€ä¸ªå¸ç›çš„è§†é¢‘æ ‡é¢˜")  
    ])  

    # 2. å®šä¹‰è„šæœ¬ç”Ÿæˆæ¨¡æ¿ï¼ˆç»“åˆæ ‡é¢˜ã€æ—¶é•¿ã€ç»´åŸºçŸ¥è¯†ï¼‰  
    script_template = ChatPromptTemplate.from_messages([  
        ("system", "ä½ æ˜¯ä¸“ä¸šè§†é¢‘è„šæœ¬åˆ›ä½œè€…ï¼Œç»“åˆä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆè„šæœ¬ï¼š"),  
        ("human", "æ ‡é¢˜ï¼š{title}\næ—¶é•¿ï¼š{duration}åˆ†é’Ÿ\nç»´åŸºç™¾ç§‘çŸ¥è¯†ï¼š{wikipedia}\nè¯·ç”Ÿæˆè¯¦ç»†è„šæœ¬")  
    ])  

    # 3. åˆå§‹åŒ– OpenAI æ¨¡å‹ï¼ˆä½¿ç”¨ç”¨æˆ·å¯†é’¥ï¼‰  
    model = ChatOpenAI(  
        api_key=api_key,  
        temperature=creativity  # åˆ›é€ åŠ›ç›´æ¥æ˜ å°„ temperature å‚æ•°  
    )  

    # 4. ç”Ÿæˆæ ‡é¢˜ï¼ˆé€šè¿‡ Chain ä¸²è”æ¨¡æ¿å’Œæ¨¡å‹ï¼‰  
    title_chain = title_template | model  
    title = title_chain.invoke({"subject": subject}).content  

    # 5. è·å–ç»´åŸºç™¾ç§‘çŸ¥è¯†ï¼ˆä¸­æ–‡ï¼‰  
    wikipedia = WikipediaAPIWrapper(lang="zh").run(subject)  

    # 6. ç”Ÿæˆè„šæœ¬ï¼ˆåŒæ ·é€šè¿‡ Chain ä¸²è”ï¼‰  
    script_chain = script_template | model  
    script = script_chain.invoke({  
        "title": title,  
        "duration": duration,  
        "wikipedia": wikipedia  
    }).content  

    return wikipedia, title, script  
```  


## å››ã€å‰ç«¯æ­å»ºï¼šStreamlit å®ç°  
### 1. æ ¸å¿ƒç»„ä»¶ä¸äº¤äº’é€»è¾‘  
#### ï¼ˆ1ï¼‰ä¾§è¾¹æ ï¼šAPI å¯†é’¥è¾“å…¥  
```python  
import streamlit as st  

st.set_page_config(page_title="è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨")  
st.title("ğŸ¬ è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨")  

# ä¾§è¾¹æ  - API å¯†é’¥è¾“å…¥  
with st.sidebar:  
    api_key = st.text_input("è¯·è¾“å…¥OpenAI APIå¯†é’¥", type="password")  
    st.markdown("[è·å–OpenAI APIå¯†é’¥](https://platform.openai.com/account/api-keys)")  # å®˜æ–¹é“¾æ¥  
```  

#### ï¼ˆ2ï¼‰ä¸»ç•Œé¢ï¼šç”¨æˆ·å‚æ•°è¾“å…¥  
```python  
# ä¸»ç•Œé¢ - è§†é¢‘å‚æ•°è¾“å…¥  
subject = st.text_input("è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜")  
duration = st.number_input("è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰", min_value=0.1, step=0.1, value=1.0)  
creativity = st.slider("è„šæœ¬åˆ›é€ åŠ›ï¼ˆ0=ä¸¥è°¨ï¼Œ1=å¤šæ ·ï¼‰", 0.0, 1.0, 0.5)  
generate_btn = st.button("ç”Ÿæˆè„šæœ¬")  
```  

#### ï¼ˆ3ï¼‰äº¤äº’é€»è¾‘ï¼šæ ¡éªŒ + åŠ è½½æ€ + ç»“æœå±•ç¤º  
```python  
if generate_btn:  
    # æ ¡éªŒè¾“å…¥ï¼ˆæ— å¯†é’¥ã€æ— ä¸»é¢˜ã€æ—¶é•¿è¿‡çŸ­ï¼‰  
    if not api_key:  
        st.error("è¯·å…ˆè¾“å…¥ OpenAI API å¯†é’¥ï¼")  
        st.stop()  # ç»ˆæ­¢åç»­æ‰§è¡Œ  
    if not subject:  
        st.error("è¯·è¾“å…¥è§†é¢‘ä¸»é¢˜ï¼")  
        st.stop()  
    if duration < 0.1:  
        st.error("æ—¶é•¿éœ€â‰¥0.1åˆ†é’Ÿï¼")  
        st.stop()  

    # åŠ è½½æ€æç¤ºï¼ˆAI æ€è€ƒæ—¶æ˜¾ç¤ºï¼‰  
    with st.spinner("AI æ€è€ƒä¸­..."):  
        wikipedia, title, script = generate_script(subject, duration, creativity, api_key)  

    # å±•ç¤ºç»“æœ  
    st.success("è§†é¢‘è„šæœ¬å·²ç”Ÿæˆï¼")  
    st.subheader("ğŸ”¥ æ ‡é¢˜ï¼š")  
    st.write(title)  
    st.subheader("ğŸ“ƒ è§†é¢‘è„šæœ¬ï¼š")  
    st.write(script)  

    # ç»´åŸºçŸ¥è¯†ï¼ˆæŠ˜å å±•ç¤ºï¼Œå¯é€‰çœ‹ï¼‰  
    with st.expander("ç»´åŸºç™¾ç§‘å‚è€ƒå†…å®¹"):  
        st.write(wikipedia)  
```  


## äº”ã€å…³é”®ç»†èŠ‚ä¸æ‰©å±•æ–¹å‘  
### 1. æ¸©åº¦å‚æ•°ï¼ˆcreativityï¼‰çš„æ„ä¹‰  
- `temperature=0`ï¼šè¾“å‡ºä¿å®ˆã€ä¸¥è°¨ï¼ˆé€‚åˆæ•™ç¨‹ã€ç§‘æ™®ç±»è„šæœ¬ï¼‰ã€‚  
- `temperature=1`ï¼šè¾“å‡ºå¼€æ”¾ã€æœ‰åˆ›æ„ï¼ˆé€‚åˆæ•…äº‹ã€å‰§æƒ…ç±»è„šæœ¬ï¼‰ã€‚  

### 2. ç»´åŸºç™¾ç§‘ API çš„ä»·å€¼  
- è§£å†³å¤§æ¨¡å‹â€œçŸ¥è¯†æ»åâ€é—®é¢˜ï¼ˆå¦‚ Sora æ¨¡å‹ 2024 å¹´å‘å¸ƒï¼Œæ—§æ¨¡å‹æ— æ•°æ®ï¼‰ï¼Œç¡®ä¿ AI è¾“å‡ºåŸºäºçœŸå®ä¿¡æ¯ã€‚  

### 3. æ‰©å±•æ–¹å‘  
- **å¤šæ¨¡å‹æ”¯æŒ**ï¼šæ›¿æ¢ä¸ºæ–‡å¿ƒä¸€è¨€ã€é€šä¹‰åƒé—®ç­‰ï¼Œåªéœ€ä¿®æ”¹ `ChatOpenAI` ä¸ºå¯¹åº”æ¨¡å‹çš„ LangChain é›†æˆç±»ã€‚  
- **å¤æ‚è„šæœ¬å®šåˆ¶**ï¼šåœ¨æç¤ºæ¨¡æ¿ä¸­åŠ å…¥åˆ†é•œã€è§’è‰²ã€å°è¯ç­‰ç»†èŠ‚è¦æ±‚ã€‚  
- **éƒ¨ç½²ä¸Šçº¿**ï¼šé€šè¿‡ Streamlit Cloud æˆ– Docker éƒ¨ç½²ï¼ˆå‚è€ƒè¯¾ç¨‹â€œåº”ç”¨éƒ¨ç½²â€ç« èŠ‚ï¼‰ã€‚  


## å…­ã€å­¦ä¹ æ€»ç»“  
- **æ ¸å¿ƒæµç¨‹**ï¼šç”¨æˆ·è¾“å…¥ â†’ ç»´åŸºè¡¥å…¨ â†’ LangChain ä¸²è”æ¨¡å‹ â†’ ç»“æœå±•ç¤ºã€‚  
- **LangChain ä¼˜åŠ¿**ï¼šé€šè¿‡â€œé“¾ï¼ˆChainï¼‰â€ç®€åŒ–å¤æ‚æµç¨‹ï¼Œè®©éä¸“ä¸šå¼€å‘è€…ä¹Ÿèƒ½å¿«é€Ÿæ­å»º AI åº”ç”¨ã€‚  
- **Streamlit ä¼˜åŠ¿**ï¼šçº¯ Python ä»£ç æ­å»º Web ç•Œé¢ï¼Œé€‚åˆ AI åº”ç”¨å¿«é€ŸåŸå‹å¼€å‘ã€‚  

åç»­å¯å°è¯•æ‰©å±•åŠŸèƒ½ï¼ˆå¦‚å¤šè¯­è¨€æ”¯æŒã€è„šæœ¬æ ¼å¼å®šåˆ¶ï¼‰ï¼Œæˆ–æ›¿æ¢ä¸ºå…¶ä»–å¤§æ¨¡å‹ï¼Œæ·±åŒ–å¯¹ LangChain ç”Ÿæ€çš„ç†è§£ï¼  
